#!/bin/bash
# openwrt
# è‹¥å‘½ä»¤å¤±è´¥è®©è„šæœ¬é€€å‡º 
set -o errexit

# è®¾ç½®ç¯å¢ƒå˜é‡
# PATH=$PATH:/usr/local/bin/
# è®¾ç½®ä»£ç†
# export https_proxy=http://127.0.0.1:7890 http_proxy=http://127.0.0.1:7890 all_proxy=socks5://127.0.0.1:7890

# è®¾ç½®è®¢é˜…æ–‡ä»¶è·¯å¾„
nodepath="/mnt/sda3/.node"

# è·å–è®¢é˜…è¿æ¥
sslink="$(grep 'ss=' "$nodepath" | cut -d'=' -f2-)"
ssrlink="$(grep 'ssr=' "$nodepath" | cut -d'=' -f2-)"

# è®¾ç½®æºè·¯å¾„
sspath="/tmp/ssrcloud_ss"
ssrpath="/tmp/ssrcloud_ssr"
# è®¾ç½®ç›®æ ‡è·¯å¾„
destpath=
# è®¾ç½®æ—¥å¿—è·¯å¾„
logspath="/mnt/sda3/rclone_ssrcloud.log"

# é€šçŸ¥
# osascript -e 'display notification "rclone converter" with title "ğŸŸ ssrcloud å¼€å§‹ä¸‹è½½" sound name "Glass"'

# å¼€å§‹ä¸‹è½½
curl "$sslink" -o "$sspath"
curl "$ssrlink" -o "$ssrpath"
#  ä¸Šä¼ åˆ° Onedrive
rclone copy "$sspath" onedrive:ç§‘å­¦ä¸Šç½‘/è®¢é˜… -P --log-file "$logspath" --log-level INFO
rclone copy "$ssrpath" onedrive:ç§‘å­¦ä¸Šç½‘/è®¢é˜… -P --log-file "$logspath" --log-level INFO

# æ¸…é™¤
rm -f "$sspath" "$ssrpath"

# é€šçŸ¥
# osascript -e 'display notification "Rclone converter" with title "ğŸŸ ssrcloud ä¸Šä¼  Onedrive å®Œæˆ" sound name "Glass"'

exit 0