#!/bin/bash
# è‹¥å‘½ä»¤å¤±è´¥è®©è„šæœ¬é€€å‡º 
set -o errexit

# è®¾ç½®ç¯å¢ƒå˜é‡
PATH=$PATH:/usr/local/bin/:/opt/homebrew/bin
# è®¾ç½®ä»£ç†
export https_proxy=http://127.0.0.1:1080 http_proxy=http://127.0.0.1:1080 all_proxy=socks5://127.0.0.1:1080

# è®¾ç½®è®¢é˜…æ–‡ä»¶è·¯å¾„
nodepath="$HOME/.node"

# è·å–è®¢é˜…è¿æ¥
sslink="$(grep 'ss=' "$nodepath" | cut -d'=' -f2-)"
ssrlink="$(grep 'ssr=' "$nodepath" | cut -d'=' -f2-)"
mosulink="$(grep 'mosu=' "$nodepath" | cut -d'=' -f2-)"

# è®¾ç½®æºè·¯å¾„
sspath="$HOME/ssrcloud_ss"
ssrpath="$HOME/ssrcloud_ssr"
mosupath="$HOME/mosu"
# è®¾ç½®ç›®æ ‡è·¯å¾„
destpath=
# è®¾ç½®æ—¥å¿—è·¯å¾„
logspath="$HOME/Library/Logs/Rclone/rclone_ssrcloud.log"

# é€šçŸ¥
osascript -e 'display notification "rclone converter" with title "ğŸŸ ssrcloud å¼€å§‹ä¸‹è½½" sound name "Glass"'

# å¼€å§‹ä¸‹è½½
curl "$sslink" -o "$sspath"
curl "$ssrlink" -o "$ssrpath"
curl "$mosulink" -o "$mosupath"
#  ä¸Šä¼ åˆ° Onedrive
rclone copy "$sspath" onedrive:ç§‘å­¦ä¸Šç½‘/è®¢é˜… -P --log-file "$logspath" --log-level INFO
rclone copy "$ssrpath" onedrive:ç§‘å­¦ä¸Šç½‘/è®¢é˜… -P --log-file "$logspath" --log-level INFO
rclone copy "$mosupath" onedrive:ç§‘å­¦ä¸Šç½‘/è®¢é˜… -P --log-file "$logspath" --log-level INFO

# æ¸…é™¤
rm -f "$sspath" "$ssrpath" "$mosupath"

# é€šçŸ¥
osascript -e 'display notification "Rclone converter" with title "ğŸŸ ssrcloud ä¸Šä¼  Onedrive å®Œæˆ" sound name "Glass"'

exit 0